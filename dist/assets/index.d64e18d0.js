import{o as t,d as i,r as s,c as e,a as n,b as r,e as h,f as a}from"./vendor.7f0260d9.js";function o(t){return Object.assign({},t)}function c(){return Number(Math.random().toString().substr(3,3)+Date.now()).toString(36)}class d{constructor(t,i,s,e,n,r,h){this.id=t,this.conf=i,this.state=s,this.direction=e,this.originalSpeed=o(i.speed),this.currentSpeed=o(i.speed),this.spawnPosition=n,this.currentPosition=o(n),this.ctx=h,this.birdImg=new Image,this.birdImg.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAACzElEQVRoBdXBoY7iQBjA8f/3DEVh8ehRlRNEXQVpqvYFzvAApAnBYe4FUKRBDApBRqLmJS5ZheMVdq7fqQoWOrt7or+fMHLCyAkjJ4ycMHLCyAkjJ4ycMHLCyAkjJ4ycMHLCDymNjSRwwQs/QPghpbGRBC544QcIX1QaG+lp95ZHqjePaq9n+qq8QLnghW8Qvqg0NtLT7i2PVG8e1V7P9FV5gXLBC98gJCqNjXTavaXv472lr24yVHs980yVFygXvPAFQqLS2Ein3Vv6Pt5b+uomQ7XXM89UeYFywQtfIAxUGhvptHuL+nhveaZuMtTmtEXNJnP6qrxAtdczqsoLlAteSCAMVBob6bR7i/p4b3mmbjLU5rRFzSZz+qq8QLXXM6rKC5QLXkggvFAaG+kc1ndS1E2G2py2qNlkTl+VF6j2ekZVeYFywQsJhBdKYyOdw/pOirrJUJvTFjWbzOmr8gLVXs+oKi9QLnghgfBCaWxkgMP6ziN1k6E2py1qNpnzSJUXKBe8kEB4oTQ2MsBhfeeRuslQm9MWNZvMeaTKC5QLXkggfKI0NtJpr2eGqPICdVjfeaRuMlK44IUBhE+UxkY67fXMEFVeoA7rO4/UTUYKF7wwgPCJ0thIp91b/pn94qE/v1HVm0cd1nf66iZDHfGkWGJRLnjhCeETpbGRTru3/DP7xUN/fqOqN486rO/01U2GOuJJscSiXPDCE8ILpbGRAXaLG32ryxR1xKOWWFK44IUBhBdKYyMD7BY3+laXKeqIRy2xpHDBCwMIA5XGRjq7xY0Uq8sUdcQzxBKLcsELAwgDlcZGOrvFjRSryxR1xDPEEotywQsDCIlKYyM9u8WNIVaXKUO44IUEQqLS2EjPbnFjiNVlyhAueCGB8E2lsZEBXPDCfyB8U2lsZAAXvPAfCCMnjJwwcsLICSMnjJwwcsLICSMnjJwwcn8B0jbqMTDIlY8AAAAASUVORK5CYII="}upper(){this.currentSpeed.VY=this.originalSpeed.VY,this.direction="up"}draw(){this.ctx.fillStyle="#2980b9",this.ctx.beginPath(),this.ctx.drawImage(this.birdImg,this.currentPosition.X,this.currentPosition.Y,this.conf.size,this.conf.size),this.ctx.fill(),this.ctx.closePath}update(t){"balance"!==this.direction&&("down"===this.direction?this.currentPosition.Y+=this.originalSpeed.VY*t:"recovery"===this.direction?(this.currentSpeed.VY+=15,this.currentSpeed.VY>=this.originalSpeed.VY&&(this.currentSpeed.VY=this.originalSpeed.VY,this.direction="down"),this.currentPosition.Y+=this.currentSpeed.VY*t):"up"===this.direction&&(this.currentSpeed.VY-=15,this.birdImg.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAC4UlEQVRoBdXBIY7qXBiA4fdbAygsHn1U5QmiroI0VWzgGhZAmhAcZjaAIg3ioCrIkVXdxCSjcGxhzt/vqt4ESsvML/o8wsgJIyeMnDBywsgJIyeMnDBywsgJIyeMnDBywsgJvyQxNjCAq73wC4RfkhgbGMDVXvgFwpsSYwMtxdHySLr2qKIqaUujGOVqL/yA8KbE2EBLcbQ8kq49qqhK2tIoRrnaCz8gDJQYG2gUR0vb91dBW5ZPUEVV0iWNYpSrvfAGYaDE2ECjOFravr8K2rJ8giqqki5pFKNc7YU3CD0lxgYaxdGivr8KumT5BLW77FHz6YK2NIpRRVWi0ihGudoLAwg9JcYGGsXRor6/Crpk+QS1u+xR8+mCtjSKUUVVotIoRrnaCwMILyTGBhqn7Z0hsnyC2l32qPl0QVsaxaiiKlFpFKNc7YUBhBcSYwON0/bOEFk+Qe0ue9R8uqAtjWJUUZWoNIpRrvbCAMILibGBxml75x1ZPkHtLnvUfLrgkTSKUa72wgDCC4mxgcZpe+cdWT5B7S571Hy64JE0ilGu9sIAwguJsYEeTts7XbJ8whCu9kIPwguJsYEeTts7XbJ8whCu9kIPwhOJsYFGcbT8Nf/DQ58fqHTtUaftnbYsn6DOeIZYYVGu9kIH4YnE2ECjOFr+mv/hoc8PVLr2qNP2TluWT1BnPEOssChXe6GD8ERibKBRVCVd0ihGHZY32jbXGeqMR62wDOFqL/QgPJEYG2gUVUmXNIpRh+WNts11hjrjUSssQ7jaCz0ITyTGBhpFVfKPzw9Uuvaow/JGl811hjrj6WOFRbnaCz0ITyTGBhpFVfKPzw9Uuvaow/JGl811hjrj6WOFRbnaCz0ILyTGBjocljf62Fxn9OFqLwwgvJAYG+hwWN7oY3Od0YervTCA8EOJsYEeXO2F/4HwQ4mxgR5c7YX/gTBywsgJIyeMnDBywsgJIyeMnDBywsgJI/cfS+z0MTQvacsAAAAASUVORK5CYII=",this.currentSpeed.VY<=0&&(this.currentSpeed.VY=0,this.direction="recovery",this.birdImg.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAC4ElEQVRoBdXBIa7iQBjA8f93BlBYPHpU5QRRV0GaKi6whgOQJgSH2QugSIMoqoKMrJpLbLIKxxV2tt+qisJr33sr5vcTIidEToicEDkhckLkhMgJkRMiJ0ROiJwQOSFywjfJjA1MUHsnfAPhm2TGBiaovRO+gfBJmbGBnupsGZJvHapqG/ryJEXV3glfIHxSZmygpzpbhuRbh6rahr48SVG1d8IXCBNlxgY61dnS9+d3RV9RzlBV2/BOnqSo2jvhE4SJMmMDneps6fvzu6KvKGeoqm14J09SVO2d8AnCBzJjA29c9k+GFOUMdbgdUcv5ir48SVFV26DyJEXV3gkTCB/IjA28cdk/GVKUM9ThdkQt5yv68iRFVW2DypMUVXsnTCC8kBkb6FRtwzt5kqIu+yd9RTlDHW5H1HK+oi9PUlTVNqg8SVG1d8IEwguZsYFO1Ta8kycp6rJ/0leUM9ThdkQt5yv68iRFVW2DypMUVXsnTCC8kBkb6FRtwxh5kqIu+yd9RTlDHW5H1HK+YkiepKjaO2EC4YXM2ECnahvGyJMUddk/6SvKGepwO6KW8xVD8iRF1d4JEwgvZMYGOtXZ8s/yB4N+/UTlW4e67J8MKcoZU9TeCSMIL2TGBjrV2fLP8geDfv1E5VuHuuyfDCnKGVPU3gkjCB/IjA10qrNlSL51qMv+yZCinKGuOKbYYFG1d8IbwgcyYwOd6mwZkm8d6rJ/MqQoZ6grjik2WFTtnfCGMFJmbGDAaf1gyO6+QF1xqA2WKWrvhBGEkTJjAwNO6wdDdvcF6opDbbBMUXsnjCCMlBkb6JzWD6bY3ReoK44xNlhU7Z0wgjBSZmygc1o/mGJ3X6CuOMbYYFG1d8IIwkSZsYGe0/rBGLv7gjFq74QJhIkyYwM9p/WDMXb3BWPU3gkTCF+UGRsYofZO+A+EL8qMDYxQeyf8B0LkhMgJkRMiJ0ROiJwQOSFyQuSEyAmR+wu9EfIx3PgeXQAAAABJRU5ErkJggg=="),this.currentPosition.Y-=this.currentSpeed.VY*t))}}class g{constructor(t){this.ctx=t.getContext("2d"),this.birds=[]}createBird(t,i,s="padding",e="down",n,r){r||(r=n);const h=new d(t,i,s,e,n,r,this.ctx);return"self"===i.ascription?this.myBird=h:this.birds.push(h),{id:t,bird:h}}getAllBirds(){return[this.myBird,...this.birds]}static getInstance(t){return g.instance||(g.instance=new g(t)),g.instance}}class l{constructor(t,i,s,e,n,r,h,a,c){this.id=t,this.conf=i,this.height=s,this.placePosition=e,this.movingStatus=n,this.visibilityStatus=r,this.originalSpeed=o(i.speed),this.currentSpeed=o(i.speed),this.spawnPosition=h,this.currentPosition=o(h),this.hasNext=!0,this.ctx=c.getContext("2d"),this.canvas=c,this.obstacleImg=new Image,this.obstacleImg.src="top"===e?"/assets/pipe_down.19355477.png":"/assets/pipe_up.6a09417a.png"}draw(){this.ctx.beginPath(),this.ctx.drawImage(this.obstacleImg,this.currentPosition.X,this.currentPosition.Y,this.conf.width,this.height),this.ctx.fill(),this.ctx.closePath()}update(t){this.currentPosition.X-=this.originalSpeed.VX*t,this.currentPosition.X<=-this.conf.width&&p.emit("removeObstacle",this.id),this.currentPosition.X<=this.canvas.width-4*this.conf.width&&this.hasNext&&(p.emit("createNextObstacle",this.id),this.hasNext=!1)}}class u{constructor(t){this.canvas=t,this.conf={width:100,clearance:200,speed:{VX:100,VY:0}},this.randomPosition=this.createRandomPosition(),this.id=c(),this.topPart=this.createTopObstacle(this.randomPosition.topObstacle),this.bottomPart=this.createBottomObstacle(this.randomPosition.bottomObstacle)}createRandomPosition(){let t=Math.floor(301*Math.random()+100),i={X:this.canvas.width,Y:this.canvas.height-t,height:t};return{topObstacle:{X:this.canvas.width,Y:0,height:this.canvas.height-t-this.conf.clearance},bottomObstacle:i}}createTopObstacle(t){return new l(this.id,this.conf,t.height,"top","move","hidden",t,t,this.canvas)}createBottomObstacle(t){return new l(this.id,this.conf,t.height,"bottom","move","hidden",t,t,this.canvas)}getCompleteObstacle(){return{id:this.id,obstacles:[this.topPart,this.bottomPart]}}}class A{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.obstaclesSet=new Map}createObstacle(){return new u(this.canvas).getCompleteObstacle()}static getInstance(t){return A.instance||(A.instance=new A(t)),A.instance}}class b{constructor(){this.eventList={}}on(t,i){this.eventList[t]?this.eventList[t].push(i):this.eventList[t]=[i]}emit(t,...i){this.eventList[t]&&this.eventList[t].forEach((t=>{t(...i)}))}static getInstance(){return b.instance||(b.instance=new b),b.instance}}const p=b.getInstance(),w={activationKeys:[" ","w","ArrowUp"],confirmKeys:[" "]};class m{constructor(t,i,s,e){this.ctx=t.getContext("2d"),this.birdFactory=i,this.boardWidth=s,this.boardHeight=e,this.birds=new Map,this.obstacles=new Map,this.startTime,this.status="running",this.bgImge=new Image,this.bgImge.src="/assets/bg_night.63285d0b.png",this.score=0}addBirdEntity(t){this.birds.set(t.id,t.bird)}addObstacleEntities(t){this.obstacles.set(t.id,t.obstacles)}removeObstacleEntities(t){this.obstacles.delete(t)}getAllBirdEntities(){return Array.from(this.birds.values())}getAllObstacleEntities(){const t=Array.from(this.obstacles.values()),i=[];return t.forEach((t=>i.push(...t))),i}run(){window.requestAnimationFrame(this.process.bind(this))}getMyBird(){return this.birdFactory.myBird}process(t){const i=this.getAllBirdEntities(),s=this.getAllObstacleEntities();this.startTime||(this.startTime=t);let e=(t-this.startTime)/1e3;this.startTime=t;for(let n=0;n<i.length;n++)i[n].update(e);for(let n=0;n<s.length;n++)s[n].update(e);this.ctx.clearRect(0,0,this.boardWidth,this.boardHeight),this.clashCheck();for(let n=0;n<s.length;n++)s[n].draw();for(let n=0;n<i.length;n++)i[n].draw();this.ctx.font="18px bold 黑体","running"===this.status&&this.ctx.fillText("当前分数："+this.score,50,50),"running"===this.status&&window.requestAnimationFrame(this.process.bind(this))}clashCheck(){const t=this.getAllObstacleEntities(),i=this.getMyBird(),s=i.currentPosition.X,e=i.currentPosition.Y,n=i.conf.size;s-20>=t[0].currentPosition.X-n&&s+20<=t[0].currentPosition.X+t[0].conf.width?(this.isCounting=!0,(e+20<=t[0].height||e-20>=this.boardHeight-n-t[1].height)&&(this.status="endding",this.score=0)):s>t[0].currentPosition.X+t[0].conf.width&&this.isCounting&&(this.score++,this.isCounting=!1)}}function v(i){t((()=>{const t=i.value;let s=window.innerWidth,e=window.innerHeight;t.width=s,t.height=e,function(t){const i=g.getInstance(t),s=A.getInstance(t),e=new m(t,i,t.width,t.height);let n="";document.addEventListener("keydown",(t=>{t.defaultPrevented||w.activationKeys.includes(t.key)&&e.getMyBird().upper()}));const r=i.createBird(c(),{size:80,speed:{VX:0,VY:400},upDuration:300,ySpeedDecrease:15,ascription:"self"},void 0,void 0,{X:100,Y:100});e.addBirdEntity(r),e.addObstacleEntities(s.createObstacle()),p.on("removeObstacle",(t=>{e.removeObstacleEntities(t)})),p.on("createNextObstacle",(t=>{n!==t&&e.addObstacleEntities(s.createObstacle()),n=t})),e.run()}(t)}))}var B=i({name:"material",setup(){const t=s();return v(t),{GameCanvas:t}}});const y={class:"Material"},C={id:"GameCanvas",ref:"GameCanvas"};B.render=function(t,i,s,h,a,o){return r(),e("div",y,[n("canvas",C,null,512)])};var I=i({name:"App",components:{Material:B}});I.render=function(t,i,s,n,a,o){const c=h("Material");return r(),e(c)};a(I).mount("#app");
